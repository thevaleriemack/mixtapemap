<!DOCTYPE html>
<html>
    <head>
        <!--  Please note Bootstrap is only used solely for the grid and table layouts.  -->
        <title>5100 Masters Capstone - Created by Denay Mack (dgm97)</title>
        <link rel="stylesheet/less" type="text/css" href="assets/stylesheets/main.less" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"/>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.7.2/less.min.js"></script>
        <script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script>
    </head>
    <body>
        <div class="container">
            <header>
                <h1>Mix Tape Map</h1>
                <h2>5100 Masters Capstone</h2>
                <ul>
                    <li>About</li>
                </ul>
            </header>
            <div class="row">
                <div class="col-lg-2"></div>
                <div class="col-lg-8">
                    <svg id="visualization">
                    </svg>            
                    <!-- <table class="table">
                        <thead>
                            <tr>
                              <th>#</th>
                              <th>Song</th>
                              <th>Artist</th>
                              <th>Play</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>Redemption Song</td>
                                <td>Bob Marley</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table> -->
                </div>
                <div class="col-lg-2"></div>
            </div>
        </div>
        <script>
            /*************************
            ********* app.js *********
            **************************/
            
            var width = 700;
            var height = 700;
            
            data = {};
            var nodes = [
                {x: width/2, y: height/2},
                {x: width/2, y: (height/2)-20}
            ];
            var links = [
                {source: 0, target: 1}
            ];
            
            var svg = d3.select("#visualization")
            .attr("width", width)
            .attr("height", height);
            
            var force = d3.forceSimulation()
            .nodes(nodes);
            
            var link = svg.selectAll("link")
            .data(links)
            .enter().append("line")
            .attr("class", "link")
            .style("stroke", "#777")
            .style("stroke-width", 0);
            
            var node = svg.selectAll(".node")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", 4)
            .style("fill", "#ccc");
            
            force.on('end', function() {
                node.attr('r', width/25)
                .attr('cx', function(d) { return d.x; })
                .attr('cy', function(d) { return d.y; });
                link.attr('x1', function(d) { return d.source.x; })
                .attr('y1', function(d) { return d.source.y; })
                .attr('x2', function(d) { return d.target.x; })
                .attr('y1', function(d) { return d.target.y; })
            });
            
            function updateData(infoArray, mode, extraInfo)
              {
                data["nodes"] = []
                data["links"] = []
                if(mode === "genre")
                {
                  data["nodes"].push({
                    "name"  : toTitleCase(extraInfo),
                    "match" : 75,
                    "url"   : "#",
                    "id"    : "node_"+(Date.now()).toString(),
                    "r"     : 1.33*Math.sqrt(75),
                    "root"  : 1,
                    "focus" : rootFoci[rootIter]
                    })
                }
                for(i in infoArray)
                { 
                  var match = (mode != "genre") ? infoArray[i].match * 100 : 75
                  if(mode === "hot")
                  {
                    var logScale = d3.scale.sqrt().range([1,3])
                    match = logScale(infoArray[i].percentagechange)
                  }
                  data["nodes"].push({
                    "name"  : infoArray[i].name,
                    "match" : match,
                    "url"   : infoArray[i].url,
                    "id"    : "node_"+(Date.now()+i).toString(),
                    "r"     : 1.33*Math.sqrt(match),
                    "root"  : 0,
                    "focus" : leafFoci[leafIter]
                  })
                  var currentLength = data["nodes"].length
                  if(mode === "track")
                  {
                    data["nodes"][currentLength-1]["artist"] = infoArray[i].artist.name
                  }
                }

                for(var i = 1; i < data["nodes"].length; i++)
                {
                  data["links"].push({"source": 0, "target": i})
                }
                rootIter++;
                leafIter++;
              }
  
            
            function initializeGraph(result, data, mode)
              {    
                force.nodes(data["nodes"]).links(data["links"]).start();
//                svg.append("g").attr("class", "links");
//                svg.append("g").attr("class", "nodes");
//                svg.append("g").attr("class", "names");

                link = svg.select("g.links").selectAll("line.link")
                  .data(data["links"])
                  .enter().append("line")
                  .attr("class", function(d){return "link "+d.source.id+" "+d.target.id})
                  .style("stroke", "#fff")
                  .style("stroke-width", 0);

                node = svg.select("g.nodes").selectAll("circle.node")
                  .data(data["nodes"])
                  .enter().append("circle")
                  .attr("class", function(d){return "node " + d.id})
                  .attr("r", 0)
                  .style("fill", "#ccc")
                  .call(force.drag);

                names = svg.select("g.names").selectAll("text.name")
                  .data(data["nodes"])
                  .enter().append("text")
                  .attr("class", function(d){return "name "+d.id})
                  .style("color", "black")
                  .style("text-anchor", "middle")
                  .style("font-size", "0px")
                  .text(function(d){return d.name})
                  .attr("x", function(d){return d.x})
                  .attr("y", function(d){return d.y + (d.r + 17)});

                node.transition()
                 .delay(1200)
                 .duration(150)
                 .attr("r", function(d){return d.r});

                link.transition()
                 .delay(1200)
                 .duration(150)
                 .style("stroke-width", 1.1)
                 .style("stroke", "#999");

                names.transition()
                 .delay(3000)
                 .duration(100)
                 .style("font-size", "14px");
              }

            
            function resetGraph()
              {
                if(typeof force === "object")
                {
                  node.data([]).exit().remove()
                  names.data([]).exit().remove()
                }

                force = d3.layout.force()
                  .charge(-3000)
                  .linkDistance(function(d){
                  //return 13*Math.sqrt((searchCount+1)*d.target.match)
                    return distanceScale(d.target.match)
                    })
                  .linkStrength(function(d){
                    return 0.18
                    //return strengthScale((searchCount+1)*d.target.match)
                    })
                  .gravity(0.1)
                  .size([width,height])
                  .on("tick", tick);
              }
            
        </script>
    </body>
</html>